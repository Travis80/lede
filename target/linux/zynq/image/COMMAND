check_image() {
	local board_name=$1
	local fw_version=$(sed -n '/^Package: firmware$/,/Version/s/.*Version: //p' /usr/lib/opkg/status)
	local fw_version_compat="2018-09-22-1-8d9b127d"

	echo "Checking firmware compatibility..."

	if test x"$board_name" != x"am1-s9" || test x"$fw_version" != x"$fw_version_compat"; then
		echo "Firmware upgrade is compatible only with version '$fw_version_compat'"
		echo "Installed version is: $fw_version ($board_name)"
		return 1
	fi

	return 0
}

pre_upgrade() {
	local board_name=$1
	local tar_file=$2

	echo "Upgrading SPL..."
	mtd erase boot
	tar xf $tar_file sysupgrade-$board_name/spl -O | mtd write - boot
}
